<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>json2tree.com | JSON Visualizer | JSON to Tree</title>
  <link rel="icon" type="image/svg+xml"
    href="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgY2xhc3M9ImJpIGJpLWZpbGV0eXBlLWpzb24iIGZpbGw9ImN1cnJlbnRDb2xvciIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2IiB3aWR0aD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTE0IDQuNVYxMWgtMVY0LjVoLTJBMS41IDEuNSAwIDAgMSA5LjUgM1YxSDRhMSAxIDAgMCAwLTEgMXY5SDJWMmEyIDIgMCAwIDEgMi0yaDUuNUwxNCA0LjVaTTQuMTUxIDE1LjI5YTEuMTc2IDEuMTc2IDAgMCAxLS4xMTEtLjQ0OWguNzY0YS41NzguNTc4IDAgMCAwIC4yNTUuMzg0Yy4wNy4wNDkuMTU0LjA4Ny4yNS4xMTQuMDk1LjAyOC4yMDEuMDQxLjMxOS4wNDEuMTY0IDAgLjMwMS0uMDIzLjQxMy0uMDdhLjU1OS41NTkgMCAwIDAgLjI1NS0uMTkzLjUwNy41MDcgMCAwIDAgLjA4NC0uMjkuMzg3LjM4NyAwIDAgMC0uMTUyLS4zMjZjLS4xMDEtLjA4LS4yNTYtLjE0NC0uNDYzLS4xOTNsLS42MTgtLjE0M2ExLjcyIDEuNzIgMCAwIDEtLjUzOS0uMjE0IDEuMDAxIDEuMDAxIDAgMCAxLS4zNTItLjM2NyAxLjA2OCAxLjA2OCAwIDAgMS0uMTIzLS41MjRjMC0uMjQ0LjA2NC0uNDU3LjE5LS42MzkuMTI4LS4xODEuMzA0LS4zMjIuNTI4LS40MjIuMjI1LS4xLjQ4NC0uMTQ5Ljc3Ny0uMTQ5LjMwNCAwIC41NjQuMDUuNzc5LjE1Mi4yMTcuMTAyLjM4NC4yMzkuNS40MS4xMi4xNy4xODYuMzU5LjIuNTY2aC0uNzVhLjU2LjU2IDAgMCAwLS4xMi0uMjU4LjYyNC42MjQgMCAwIDAtLjI0Ni0uMTgxLjkyMy45MjMgMCAwIDAtLjM3LS4wNjhjLS4yMTYgMC0uMzg3LjA1LS41MTIuMTUyYS40NzIuNDcyIDAgMCAwLS4xODUuMzg0YzAgLjEyMS4wNDguMjIuMTQ0LjNhLjk3Ljk3IDAgMCAwIC40MDQuMTc1bC42MjEuMTQzYy4yMTcuMDUuNDA2LjEyLjU2Ni4yMTFhMSAxIDAgMCAxIC4zNzUuMzU4Yy4wOS4xNDguMTM1LjMzNS4xMzUuNTYgMCAuMjQ3LS4wNjMuNDY2LS4xODguNjU2YTEuMjE2IDEuMjE2IDAgMCAxLS41MzkuNDM5Yy0uMjM0LjEwNS0uNTIuMTU4LS44NTguMTU4LS4yNTQgMC0uNDc2LS4wMy0uNjY1LS4wOWExLjQwNCAxLjQwNCAwIDAgMS0uNDc4LS4yNTIgMS4xMyAxLjEzIDAgMCAxLS4yOS0uMzc1Wm0tMy4xMDQtLjAzM2ExLjMyIDEuMzIgMCAwIDEtLjA4Mi0uNDY2aC43NjRhLjU3Ni41NzYgMCAwIDAgLjA3NC4yNy40OTkuNDk5IDAgMCAwIC40NTQuMjQ2Yy4xOSAwIC4zMy0uMDU1LjQyMi0uMTY0LjA5MS0uMTEuMTM3LS4yNjUuMTM3LS40NjZ2LTIuNzQ1aC43OTF2Mi43MjVjMCAuNDQtLjExOS43NzQtLjM1NyAxLjAwNS0uMjM3LjIzLS41NjUuMzQ1LS45ODUuMzQ1YTEuNTkgMS41OSAwIDAgMS0uNTY4LS4wOTQgMS4xNDUgMS4xNDUgMCAwIDEtLjQwNy0uMjY2IDEuMTQgMS4xNCAwIDAgMS0uMjQzLS4zOVptOS4wOTEtMS41ODV2LjUyMmMwIC4yNTYtLjAzOS40Ny0uMTE3LjY0MWEuODYyLjg2MiAwIDAgMS0uMzIyLjM4Ny44NzcuODc3IDAgMCAxLS40Ny4xMjYuODgzLjg4MyAwIDAgMS0uNDctLjEyNi44Ny44NyAwIDAgMS0uMzItLjM4NyAxLjU1IDEuNTUgMCAwIDEtLjExNy0uNjQxdi0uNTIyYzAtLjI1OC4wMzktLjQ3MS4xMTctLjY0MWEuODcuODcgMCAwIDEgLjMyLS4zODcuODY4Ljg2OCAwIDAgMSAuNDctLjEyOWMuMTc3IDAgLjMzMy4wNDMuNDcuMTI5YS44NjIuODYyIDAgMCAxIC4zMjIuMzg3Yy4wNzguMTcuMTE3LjM4My4xMTcuNjQxWm0uODAzLjUxOXYtLjUxM2MwLS4zNzctLjA2OS0uNzAxLS4yMDUtLjk3M2ExLjQ2IDEuNDYgMCAwIDAtLjU5LS42M2MtLjI1My0uMTQ2LS41NTktLjIyLS45MTYtLjIyLS4zNTYgMC0uNjYyLjA3NC0uOTIuMjJhMS40NDEgMS40NDEgMCAwIDAtLjU4OS42MjhjLS4xMzcuMjcxLS4yMDUuNTk2LS4yMDUuOTc1di41MTNjMCAuMzc1LjA2OC42OTkuMjA1Ljk3My4xMzcuMjcxLjMzMy40OC41ODkuNjI2LjI1OC4xNDUuNTY0LjIxNy45Mi4yMTcuMzU3IDAgLjY2My0uMDcyLjkxNy0uMjE3LjI1Ni0uMTQ2LjQ1Mi0uMzU1LjU4OS0uNjI2LjEzNi0uMjc0LjIwNS0uNTk4LjIwNS0uOTczWm0xLjI5LS45MzV2Mi42NzVoLS43NDZ2LTMuOTk5aC42NjJsMS43NTIgMi42NmguMDMydi0yLjY2aC43NXY0aC0uNjU2bC0xLjc2MS0yLjY3NmgtLjAzMloiIGZpbGwtcnVsZT0iZXZlbm9kZCIvPjwvc3ZnPg==">
  <!-- Favicon alternativo para navegadores que no soportan SVG -->
  <link rel="icon" type="image/png"
    href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAFhklEQVRoQ+Wae6hURRzHZ9ey2CyjsksvKqIH3LAXNxJ7WEFGRi8MKUvSPzQLKkh6QE/6q4yy6GEQRZJBhUWFZQSKvZOk8toFoeIilpV/9LTydbfP99yZs+PZ3TNnz57b7qXhfpk5Z+bM/L7ze8zszC2ZcNqLJvPGGHP1LmNOpLxP+JMyTYaaNRuk4lygvO1UCvRwGPXLwUmN2+nzamYhPFqFkUgjoJn/rF74VoT2NeG+i98VQiKNwE0I/5id3u1mD3O32Wle5PmHzFPeuOF9vL7XVrVNIo2AZv90O9Ad5A+2Kbj73CMQaaMtEikESn9g3+PsqIeSby6eQNzjRkpy7O9aHSNNA753hpy9lXF9E/K/y0UiQCB2uP+CgMi0TKIrNJBYNTaOx5x+y2hOaT6ACfE3HP2K1MCt9PhwQ5urMcns2J3QwBkI/0kGp8lEohMEkL3E6l69KEQChQyyIUnddgQJWK0WaUKSGzM3S+l0WoaNSKomggTsLBVNwE2+FsrJoKeJNm6370Xi6EZtmgtWwnWrIxJGQ5bj1ZeiQJJmBZ3WQIhMLL0cpzUN2H2y3UOOlAmFCdRa5CBQi8sdJhAJkoNAgH1o+gqoD+7HutwHhp04LRJ2OQEn/Wg1oTIEdDaQsh/rbg1Ea1HsSXmc2AbRJjG4ACcNdTHanXi3M5s8GkhXX2j6CqivxjaQdyUe4c1ciGNkQmm7ge52YhYB7+fm6DQhf2uaazM3Qj9oQqbj6m0Uiozof6qBbnBiM/yTZjRrIJ8JZbXTjrbr1A+VwkhnIXA4o+nU4G8w4I28N+Up4BiwDXwNdCRff7fUa8ZRew51OuXm1Nt8Dr5JsHDj6BQ8eQeha60TbPsv/DGyENAxoI4D1wF31XQx5WdZInsSN0zq/ErwrSfczZQfAPt67xQe3wBzwC/2/ULyBfbbieR/1dpX+nhcY5915L/V1eUhoJn4CoxlkWfGq69RPgBcB3rocADpJAB3guZG8ISNItLeSnAk0Kkc94bmIyDNqO1CYs0Cqz7dDN3ihKwY0wcbS2AiBNblJ8Ag9zPIPXT+PXDmo7GOBx8DTcpUc5Tp5x7yR8rjkXQ5El5OeYcV6iryl2x5BvkrIgCkASXxONsS1DMacAQwx5Y1UMKEqrEJLaIDmcVm02uOw7b/dDOVyC/k+R377lRymZefvuRBJrkUXBMRKENgKDIdJt1sACeDf9onsLsPXEaHr1tJdCHxMvjA4ldPwrmUnwGaTcwtMhM/vYCuZjExMqMzIwLDGngTKEBcAB4COl7sQ61r7L4ihwbqnLj8OHLJvrVERonCNiR9i+JdQLOHMCWEqip6aUaT6Ule3AD6gXzGEZBzS8P99FkZqphJFXRS84E8JlQfhSSMDluvBXJCnfk7IX+mrBt9mcUjQCFWM5pMT/PieqCAIFPxCUjL88FTYL1t96HtoAgN1AkjAeeBR4GcWILJlpfYljpO/z3x1TKerwDvAZlLkoD6UdSaAt4FU0MEdDOPaURJYcwtWs9hILMxmU95N8nsaWabHeWDeZbtullxsm1h1IOwVd0rvw20dpixY8zM7bviqKNXmsVBcKAV/LYGBNROUQ4NlVnI4vUxVQOb+ED/H7ECKA4fAV4F+xO1F+OG88mXkMt05MCXAkWTMsRmESSft0zOJ9fsucvynyjPBKvAIUCmcQnYCU4BMpOkBmxXkT8o8rmUSkBmsNhr7IpaOE4Dcs5eoHi/n62UcOrU/ReLFrbpQEFDbSX0BNtWkUgLmJLqNfPuwq8ZgTJafZ/Gk+2Pq6APyH7FWgvTFqB9ixautR6xY+2788i1v9mK5Q8gkmxeE6CZdUlavBNMs23lC2uhsQhNysxcksbl+KuBti5+kiz6Pw35xVlAkS1K/wK4DndA4unMOQAAAABJRU5ErkJggg==">
  <style>
    /* Variables para temas */
    :root {
      --color-bg-primary: #ffffff;
      --color-bg-secondary: #f9fafb;
      --color-text-primary: #1f2937;
      --color-text-secondary: #6b7280;
      --color-border: #e5e7eb;
      --color-border-light: #f3f4f6;
      --color-hover: #f3f4f6;
      --color-error-bg: #fee2e2;
      --color-error-text: #b91c1c;
      --color-string: #16a34a;
      --color-number: #2563eb;
      --color-boolean: #9333ea;
      --color-null: #dc2626;
      --color-muted: #9ca3af;
      --color-resizer-hover: #94a3b8;
    }

    /* Tema oscuro */
    [data-theme="dark"] {
      --color-bg-primary: #1f2937;
      --color-bg-secondary: #111827;
      --color-text-primary: #f9fafb;
      --color-text-secondary: #d1d5db;
      --color-border: #374151;
      --color-border-light: #374151;
      --color-hover: #374151;
      --color-error-bg: #7f1d1d;
      --color-error-text: #fecaca;
      --color-string: #4ade80;
      --color-number: #60a5fa;
      --color-boolean: #c084fc;
      --color-null: #f87171;
      --color-muted: #9ca3af;
      --color-resizer-hover: #64748b;
    }

    /* Reset and base styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }

    body {
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      background-color: var(--color-bg-primary);
      color: var(--color-text-primary);
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    /* Header styles */
    header {
      padding: 12px 16px;
      border-bottom: 1px solid var(--color-border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background-color: var(--color-bg-primary);
    }

    h1 {
      font-size: 1.25rem;
      font-weight: 500;
      color: var(--color-text-primary);
    }

    .header-controls {
      display: flex;
      gap: 8px;
    }

    /* Button styles */
    button {
      background: none;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 6px;
      border-radius: 4px;
      color: var(--color-text-secondary);
    }

    button:hover {
      background-color: var(--color-hover);
    }

    button svg {
      width: 16px;
      height: 16px;
    }

    /* Estilo mejorado para los botones de acción principales */
    #format-btn,
    #clear-btn,
    #copy-btn,
    #expand-all-tree,
    #collapse-all-tree,
    #expand-all-table,
    #collapse-all-table {
      border: 1px solid var(--color-border);
      border-radius: 6px;
      padding: 6px 12px;
      background-color: var(--color-bg-secondary);
      transition: all 0.2s ease;
    }

    #format-btn:hover,
    #clear-btn:hover,
    #copy-btn:hover,
    #expand-all-tree:hover,
    #collapse-all-tree:hover,
    #expand-all-table:hover,
    #collapse-all-table:hover {
      background-color: var(--color-hover);
      border-color: var(--color-text-secondary);
    }

    .btn-group {
      display: flex;
      gap: 4px;
    }

    /* Estilos para el atajo de teclado */
    .kbd-shortcut {
      font-size: 0.75rem;
      opacity: 0.8;
      margin-left: 4px;
      padding: 2px 4px;
      border-radius: 3px;
      background-color: var(--color-bg-secondary);
      border: 1px solid var(--color-border);
    }

    /* Main content and columns */
    .main-content {
      display: flex;
      flex: 1;
      overflow: hidden;
      position: relative;
      height: calc(100vh - 60px);
      /* Altura calculada restando el header */
    }

    .column {
      display: flex;
      flex-direction: column;
      flex: 1;
      min-width: 150px;
      position: relative;
      overflow: hidden;
      /* Prevenir desbordamiento */
      transition: width 0.1s ease;
      /* Suavizar los cambios de ancho */
    }

    /* Primero quitamos los divisores anteriores */
    .column-resizer {
      display: none;
    }

    /* Hacemos que las columnas sean redimensionables directamente */
    #input-column {
      resize: horizontal;
      overflow: auto;
      border-right: 8px solid var(--color-border);
      max-width: 90%;
      /* Evitar que ocupe todo el ancho */
    }

    #tree-column {
      resize: horizontal;
      overflow: auto;
      border-right: 8px solid var(--color-border);
      max-width: 90%;
      /* Evitar que ocupe todo el ancho */
    }

    /* La última columna no necesita resize */
    #table-column {
      overflow: auto;
    }

    /* Estilo para los bordes redimensionables */
    .column:hover {
      border-right-color: var(--color-resizer-hover);
    }

    /* Cursor específico para el borde redimensionable */
    #input-column,
    #tree-column {
      cursor: ew-resize;
    }

    .column-header {
      padding: 12px 16px;
      border-bottom: 1px solid var(--color-border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background-color: var(--color-bg-primary);
    }

    .column-title {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--color-text-primary);
    }

    .column-content {
      flex: 1;
      padding: 12px 16px;
      overflow: auto;
      background-color: var(--color-bg-primary);
    }

    /* Input column */
    #json-input {
      width: 100%;
      height: 100%;
      resize: none;
      border: none;
      font-family: 'Courier New', Courier, monospace;
      font-size: 0.875rem;
      outline: none;
      background-color: var(--color-bg-primary);
      color: var(--color-text-primary);
    }

    /* Tree view */
    .tree-node {
      font-family: 'Courier New', Courier, monospace;
      font-size: 0.875rem;
      margin-bottom: 2px;
    }

    .tree-content {
      display: flex;
      align-items: flex-start;
    }

    .tree-toggle {
      margin-right: 4px;
      cursor: pointer;
      width: 16px;
      height: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-text-secondary);
    }

    .tree-label {
      color: var(--color-text-primary);
    }

    .tree-children {
      margin-left: 16px;
      position: relative;
    }

    .tree-children::before {
      content: '';
      position: absolute;
      left: -8px;
      top: 0;
      height: 100%;
      width: 1px;
      background-color: var(--color-border);
    }

    /* Table view */
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.875rem;
    }

    thead {
      background-color: var(--color-bg-secondary);
    }

    th {
      text-align: left;
      padding: 8px;
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--color-text-secondary);
    }

    td {
      padding: 8px;
      border-bottom: 1px solid var(--color-border-light);
      color: var(--color-text-primary);
    }

    tr:hover {
      background-color: var(--color-hover);
    }

    .table-toggle {
      margin-right: 4px;
      cursor: pointer;
      color: var(--color-text-secondary);
    }

    .nested-table {
      padding-left: 20px;
    }

    /* Value colors */
    .string-value {
      color: var(--color-string);
    }

    .number-value {
      color: var(--color-number);
    }

    .boolean-value {
      color: var(--color-boolean);
    }

    .null-value {
      color: var(--color-null);
    }

    /* Highlight search results */
    .search-highlight {
      background-color: rgba(250, 204, 21, 0.3);
      padding: 2px;
      border-radius: 2px;
    }

    #error-container {
      position: fixed;
      bottom: 12px;
      left: auto;
      right: auto;
      width: 100%;
      padding: 0 10%;
      z-index: 1000;
    }

    /* Error message */
    .error-message {
      margin-top: 16px;
      padding: 12px;
      background-color: var(--color-error-bg);
      border-radius: 4px;
      color: var(--color-error-text);
      width: 100%;
      max-width: 100%;
      overflow: hidden;
      position: relative;
      animation: slideUp 0.3s ease-out;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    @keyframes slideUp {
      from {
        transform: translateY(100px);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .error-close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      cursor: pointer;
      color: var(--color-error-text);
      padding: 2px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      width: 24px;
      height: 24px;
    }

    .error-close-btn:hover {
      background-color: rgba(0, 0, 0, 0.1);
    }

    .error-title {
      font-weight: bold;
      margin-bottom: 8px;
      padding-right: 30px;
      /* Dejar espacio para el botón de cierre */
    }

    .error-help-message {
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      padding: 10px;
      margin-bottom: 10px;
      font-size: 0.9rem;
      line-height: 1.5;
    }

    .error-help-message code {
      background-color: rgba(0, 0, 0, 0.1);
      padding: 2px 4px;
      border-radius: 3px;
      font-family: 'Courier New', Courier, monospace;
    }

    .error-context-highlight {
      background-color: rgba(220, 38, 38, 0.6);
      padding: 0 2px;
      border-radius: 2px;
      font-weight: bold;
    }

    .error-position {
      font-size: 0.875rem;
      margin-bottom: 12px;
      text-decoration: underline;
      color: var(--color-error-text);
    }

    .click-hint {
      font-style: italic;
      font-size: 0.8rem;
      opacity: 0.9;
    }

    .json-error-viewer {
      font-family: 'Courier New', Courier, monospace;
      white-space: pre;
      overflow-x: auto;
      background-color: rgba(0, 0, 0, 0.05);
      padding: 8px;
      border-radius: 4px;
      line-height: 1.5;
      font-size: 0.875rem;
      max-height: 300px;
      overflow-y: auto;
      width: 100%;
    }

    .line-number {
      display: inline-block;
      width: 30px;
      color: var(--color-text-secondary);
      user-select: none;
      opacity: 0.7;
    }

    .json-line {
      white-space: pre;
    }

    .json-error-highlight {
      background-color: rgba(220, 38, 38, 0.3);
      border-radius: 2px;
      padding: 2px 0;
    }

    /* Empty state */
    .empty-state {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: var(--color-muted);
    }

    /* Theme toggle */
    .theme-toggle {
      margin-right: 8px;
    }

    /* Search container styles */
    .search-container {
      display: flex;
      align-items: center;
    }

    .search-container input {
      padding: 8px;
      border: 1px solid var(--color-border);
      border-radius: 4px;
      margin-right: 8px;
      background-color: var(--color-bg-secondary);
      color: var(--color-text-primary);
    }

    .search-container button {
      background: none;
      border: none;
      cursor: pointer;
      padding: 6px;
      border-radius: 4px;
      color: var(--color-text-secondary);
    }

    .search-container button:hover {
      background-color: var(--color-hover);
    }

    .search-container button svg {
      width: 16px;
      height: 16px;
    }

    /* Search stats */
    .search-stats {
      display: flex;
      align-items: center;
      font-size: 0.75rem;
      margin-left: 8px;
      color: var(--color-text-secondary);
    }

    .search-stats button {
      padding: 2px;
    }

    /* JSON Stats */
    .json-stats {
      margin-top: 16px;
      padding: 12px;
      background-color: var(--color-bg-secondary);
      border-radius: 4px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-size: 0.875rem;
      position: fixed;
      bottom: 10px;
      left: 10px;
      z-index: 1000;
    }

    .json-stats #stats-close-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 20px;
      height: 20px;
      opacity: 0.7;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: none;
      border: none;
      border-radius: 50%;
      cursor: pointer;
    }

    .json-stats #stats-close-btn:hover {
      opacity: 1;
      background-color: rgba(0, 0, 0, 0.1);
    }

    .stat-label {
      color: var(--color-text-secondary);
      margin-right: 8px;
    }

    /* Resizer styling */
    .column-resizer {
      width: 8px;
      background-color: var(--color-border);
      cursor: col-resize;
      z-index: 10;
      transition: background-color 0.2s ease;
      position: relative;
      height: 100%;
      /* Asegurar que ocupe toda la altura */
      flex-shrink: 0;
      /* Prevenir que el resizer se encoja */
    }

    .column-resizer:hover,
    .column-resizer.active {
      background-color: var(--color-resizer-hover);
      width: 8px;
      /* Mantener el ancho al pasar el ratón */
    }

    /* Cuando el redimensionador está activo, cambiar el cursor en todo el documento */
    body.resizing {
      cursor: col-resize !important;
      user-select: none;
      /* Prevenir selección de texto durante el redimensionamiento */
    }

    /* Quitamos los estilos específicos de resize de CSS */
    #input-column,
    #tree-column,
    #table-column {
      resize: none;
      overflow: visible;
      cursor: default;
      max-width: none;
      border-right: none;
    }

    /* Restauramos los divisores */
    .column-resizer {
      display: block;
      width: 12px;
      background-color: var(--color-border);
      cursor: col-resize;
      z-index: 10;
      transition: background-color 0.2s ease;
      position: relative;
      height: 100%;
      /* Asegurar que ocupe toda la altura */
      flex-shrink: 0;
      /* Prevenir que el resizer se encoja */
    }

    .column-resizer:hover,
    .column-resizer.active {
      background-color: var(--color-resizer-hover);
      width: 12px;
      /* Mantener el ancho al pasar el ratón */
    }

    /* Vamos a añadir un indicador visual más prominente para el redimensionamiento */
    .column-resizer::after {
      content: "⋮";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: var(--color-text-secondary);
      font-size: 18px;
      line-height: 1;
      opacity: 0.7;
      pointer-events: none;
      transition: opacity 0.2s ease;
    }

    .column-resizer:hover::after,
    .column-resizer.active::after {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1.2);
    }

    /* Agregar una zona de arrastre más amplia para facilitar el uso */
    .column-resizer::before {
      content: "";
      position: absolute;
      top: 0;
      left: -4px;
      right: -4px;
      bottom: 0;
      z-index: -1;
      cursor: col-resize;
    }

    /* Cuando el redimensionador está activo, cambiar el cursor en todo el documento */
    body.resizing {
      cursor: col-resize !important;
      user-select: none;
      /* Prevenir selección de texto durante el redimensionamiento */
    }

    body.resizing * {
      pointer-events: none !important;
    }
  </style>
</head>

<body>
  <!-- Header with toggle controls -->
  <header>
    <h1>
      <svg class="bi bi-filetype-json" fill="currentColor" height="20" viewBox="0 0 16 16" width="20"
        style="margin-right: 8px;" xmlns="http://www.w3.org/2000/svg">
        <path
          d="M14 4.5V11h-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5L14 4.5ZM4.151 15.29a1.176 1.176 0 0 1-.111-.449h.764a.578.578 0 0 0 .255.384c.07.049.154.087.25.114.095.028.201.041.319.041.164 0 .301-.023.413-.07a.559.559 0 0 0 .255-.193.507.507 0 0 0 .084-.29.387.387 0 0 0-.152-.326c-.101-.08-.256-.144-.463-.193l-.618-.143a1.72 1.72 0 0 1-.539-.214 1.001 1.001 0 0 1-.352-.367 1.068 1.068 0 0 1-.123-.524c0-.244.064-.457.19-.639.128-.181.304-.322.528-.422.225-.1.484-.149.777-.149.304 0 .564.05.779.152.217.102.384.239.5.41.12.17.186.359.2.566h-.75a.56.56 0 0 0-.12-.258.624.624 0 0 0-.246-.181.923.923 0 0 0-.37-.068c-.216 0-.387.05-.512.152a.472.472 0 0 0-.185.384c0 .121.048.22.144.3a.97.97 0 0 0 .404.175l.621.143c.217.05.406.12.566.211a1 1 0 0 1 .375.358c.09.148.135.335.135.56 0 .247-.063.466-.188.656a1.216 1.216 0 0 1-.539.439c-.234.105-.52.158-.858.158-.254 0-.476-.03-.665-.09a1.404 1.404 0 0 1-.478-.252 1.13 1.13 0 0 1-.29-.375Zm-3.104-.033a1.32 1.32 0 0 1-.082-.466h.764a.576.576 0 0 0 .074.27.499.499 0 0 0 .454.246c.19 0 .33-.055.422-.164.091-.11.137-.265.137-.466v-2.745h.791v2.725c0 .44-.119.774-.357 1.005-.237.23-.565.345-.985.345a1.59 1.59 0 0 1-.568-.094 1.145 1.145 0 0 1-.407-.266 1.14 1.14 0 0 1-.243-.39Zm9.091-1.585v.522c0 .256-.039.47-.117.641a.862.862 0 0 1-.322.387.877.877 0 0 1-.47.126.883.883 0 0 1-.47-.126.87.87 0 0 1-.32-.387 1.55 1.55 0 0 1-.117-.641v-.522c0-.258.039-.471.117-.641a.87.87 0 0 1 .32-.387.868.868 0 0 1 .47-.129c.177 0 .333.043.47.129a.862.862 0 0 1 .322.387c.078.17.117.383.117.641Zm.803.519v-.513c0-.377-.069-.701-.205-.973a1.46 1.46 0 0 0-.59-.63c-.253-.146-.559-.22-.916-.22-.356 0-.662.074-.92.22a1.441 1.441 0 0 0-.589.628c-.137.271-.205.596-.205.975v.513c0 .375.068.699.205.973.137.271.333.48.589.626.258.145.564.217.92.217.357 0 .663-.072.917-.217.256-.146.452-.355.589-.626.136-.274.205-.598.205-.973Zm1.29-.935v2.675h-.746v-3.999h.662l1.752 2.66h.032v-2.66h.75v4h-.656l-1.761-2.676h-.032Z"
          fill-rule="evenodd" />
      </svg>
      json2tree.com | JSON Visualizer | JSON to Tree
    </h1>
    <div class="header-controls">
      <!-- Tema claro/oscuro -->
      <button id="theme-toggle" class="theme-toggle" title="Cambiar tema">
        <svg id="theme-toggle-light-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
          <circle cx="12" cy="12" r="5"></circle>
          <line x1="12" y1="1" x2="12" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="23"></line>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
          <line x1="1" y1="12" x2="3" y2="12"></line>
          <line x1="21" y1="12" x2="23" y2="12"></line>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
        <svg id="theme-toggle-dark-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
      </button>
      <div class="search-container">
        <input type="text" id="search-input" placeholder="Search in JSON..." />
        <button id="search-btn" title="Search">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
        </button>
        <div id="search-stats" class="search-stats" style="display: none;">
          <span id="search-count">0</span> results
          <button id="prev-result" title="Previous result">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
          </button>
          <button id="next-result" title="Next result">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>
        </div>
      </div>
      <button id="toggle-input" title="Toggle Input">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <path d="M16 18 22 12 16 6"></path>
          <path d="M8 6 2 12 8 18"></path>
        </svg>
      </button>
      <button id="toggle-tree" title="Toggle Tree View">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <path d="M13 2H9a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V9z"></path>
          <path d="M13 2v7h7"></path>
          <path d="M9 16h6"></path>
          <path d="M9 12h6"></path>
        </svg>
      </button>
      <button id="toggle-table" title="Toggle Table View">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="3" y1="9" x2="21" y2="9"></line>
          <line x1="3" y1="15" x2="21" y2="15"></line>
          <line x1="9" y1="3" x2="9" y2="21"></line>
          <line x1="15" y1="3" x2="15" y2="21"></line>
        </svg>
      </button>
    </div>
  </header>

  <!-- Main content with columns -->
  <div id="error-container"></div>
  <div id="json-stats" class="json-stats" style="display: none;">
    <span class="stat-label">Stats</span>
    <button id="stats-close-btn" class="error-close-btn">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
    <div><span class="stat-label">Objects:</span> <span id="object-count">0</span></div>
    <div><span class="stat-label">Arrays:</span> <span id="array-count">0</span></div>
    <div><span class="stat-label">Strings:</span> <span id="string-count">0</span></div>
    <div><span class="stat-label">Numbers:</span> <span id="number-count">0</span></div>
    <div><span class="stat-label">Booleans:</span> <span id="boolean-count">0</span></div>
    <div><span class="stat-label">Nulls:</span> <span id="null-count">0</span></div>
  </div>
  <div class="main-content" id="main-content">
    <!-- Input Column -->
    <div class="column" id="input-column">
      <div class="column-header">
        <div class="column-title">JSON Input</div>
        <div class="btn-group">
          <button id="clear-btn" style="display: none;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
              style="margin-right: 5px;">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
            Clear
          </button>
          <button id="copy-btn" style="display: none;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
          </button>
          <button id="format-btn">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
            Format
          </button>
        </div>
      </div>
      <div class="column-content">
        <textarea id="json-input" placeholder="Paste your JSON here..."></textarea>
      </div>
    </div>

    <!-- Resizer between input and tree -->
    <div class="column-resizer" id="resizer-input-tree"></div>

    <!-- Tree View Column -->
    <div class="column" id="tree-column" style="display: none;">
      <div class="column-header">
        <div class="column-title">Tree View</div>
        <div class="btn-group">
          <button id="expand-all-tree">Expand All</button>
          <button id="collapse-all-tree">Collapse all</button>
        </div>
      </div>
      <div class="column-content" id="tree-container"></div>
    </div>

    <!-- Resizer between tree and table -->
    <div class="column-resizer" id="resizer-tree-table"></div>

    <!-- Table View Column -->
    <div class="column" id="table-column" style="display: none;">
      <div class="column-header">
        <div class="column-title">Table View</div>
        <div class="btn-group">
          <button id="expand-all-table">Expand All</button>
          <button id="collapse-all-table">Collapse All</button>
        </div>
      </div>
      <div class="column-content" id="table-container"></div>
    </div>
  </div>

  <script>
    // DOM Elements
    const jsonInput = document.getElementById('json-input');
    const formatBtn = document.getElementById('format-btn');
    const clearBtn = document.getElementById('clear-btn');
    const copyBtn = document.getElementById('copy-btn');
    const errorContainer = document.getElementById('error-container');
    const treeContainer = document.getElementById('tree-container');
    const tableContainer = document.getElementById('table-container');
    const inputColumn = document.getElementById('input-column');
    const treeColumn = document.getElementById('tree-column');
    const tableColumn = document.getElementById('table-column');
    const mainContent = document.getElementById('main-content');
    const toggleInputBtn = document.getElementById('toggle-input');
    const toggleTreeBtn = document.getElementById('toggle-tree');
    const toggleTableBtn = document.getElementById('toggle-table');
    const themeToggleBtn = document.getElementById('theme-toggle');
    const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');
    const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
    const expandAllTreeBtn = document.getElementById('expand-all-tree');
    const collapseAllTreeBtn = document.getElementById('collapse-all-tree');
    const expandAllTableBtn = document.getElementById('expand-all-table');
    const collapseAllTableBtn = document.getElementById('collapse-all-table');
    const searchInput = document.getElementById('search-input');
    const searchBtn = document.getElementById('search-btn');
    const searchStats = document.getElementById('search-stats');
    const searchCount = document.getElementById('search-count');
    const prevResultBtn = document.getElementById('prev-result');
    const nextResultBtn = document.getElementById('next-result');
    const jsonStats = document.getElementById('json-stats');
    const objectCount = document.getElementById('object-count');
    const arrayCount = document.getElementById('array-count');
    const stringCount = document.getElementById('string-count');
    const numberCount = document.getElementById('number-count');
    const booleanCount = document.getElementById('boolean-count');
    const nullCount = document.getElementById('null-count');
    const statsCloseBtn = document.getElementById('stats-close-btn');

    // State
    let parsedJson = null;
    let showInput = true;
    let showTree = false;
    let showTable = false;
    let searchResults = [];
    let currentResultIndex = -1;
    let columnWidths = {
      input: localStorage.getItem('inputColumnWidth') || '33.33%',
      tree: localStorage.getItem('treeColumnWidth') || '33.33%',
      table: localStorage.getItem('tableColumnWidth') || '33.33%'
    };
    let useCssResize = false; // Por defecto, usar el redimensionamiento JavaScript

    // Función para activar/desactivar el redimensionamiento CSS
    function toggleResizeMode() {
      useCssResize = !useCssResize;
      localStorage.setItem('useCssResize', useCssResize ? 'true' : 'false');
      applyResizeMode();
    }

    // Aplicar el modo de redimensionamiento actual
    function applyResizeMode() {
      if (useCssResize) {
        // Desactivar resizers JS
        document.querySelectorAll('.column-resizer').forEach(r => {
          r.style.display = 'none';
        });

        // Activar resize CSS
        inputColumn.style.resize = 'horizontal';
        inputColumn.style.overflow = 'auto';
        inputColumn.style.borderRight = '8px solid var(--color-border)';

        treeColumn.style.resize = 'horizontal';
        treeColumn.style.overflow = 'auto';
        treeColumn.style.borderRight = '8px solid var(--color-border)';

        // El último no necesita resize
        tableColumn.style.overflow = 'auto';

        // Ajustar cursor
        inputColumn.style.cursor = 'ew-resize';
        treeColumn.style.cursor = 'ew-resize';
      } else {
        // Activar resizers JS
        document.querySelectorAll('.column-resizer').forEach(r => {
          if ((r.id === 'resizer-input-tree' && showInput && showTree) ||
            (r.id === 'resizer-tree-table' && showTree && showTable)) {
            r.style.display = 'block';
          }
        });

        // Desactivar resize CSS
        inputColumn.style.resize = 'none';
        inputColumn.style.overflow = 'visible';
        inputColumn.style.cursor = 'default';
        inputColumn.style.borderRight = 'none';

        treeColumn.style.resize = 'none';
        treeColumn.style.overflow = 'visible';
        treeColumn.style.cursor = 'default';
        treeColumn.style.borderRight = 'none';

        tableColumn.style.overflow = 'visible';
      }
    }

    // Cargar preferencia de modo resize al inicio
    function loadResizePreference() {
      const savedPreference = localStorage.getItem('useCssResize');
      if (savedPreference !== null) {
        useCssResize = savedPreference === 'true';
      }
      applyResizeMode();
    }

    // Verificar y reparar estado de columnas
    function validateColumnState() {
      // Verificar que los anchos almacenados sean válidos y sumen aproximadamente 100%
      const validateWidth = (width) => {
        if (!width || typeof width !== 'string' || !width.endsWith('%')) {
          return false;
        }
        const numValue = parseFloat(width);
        return !isNaN(numValue) && numValue > 0 && numValue <= 100;
      };

      let isValid = validateWidth(columnWidths.input) &&
        validateWidth(columnWidths.tree) &&
        validateWidth(columnWidths.table);

      // Verificar que la suma esté cerca del 100%
      if (isValid) {
        const total = parseFloat(columnWidths.input) +
          parseFloat(columnWidths.tree) +
          parseFloat(columnWidths.table);
        isValid = total >= 98 && total <= 102; // Permitir un pequeño margen de error
      }

      // Si es inválido, reiniciar a valores por defecto
      if (!isValid) {
        columnWidths = {
          input: '33.33%',
          tree: '33.33%',
          table: '33.33%'
        };

        localStorage.setItem('inputColumnWidth', columnWidths.input);
        localStorage.setItem('treeColumnWidth', columnWidths.tree);
        localStorage.setItem('tableColumnWidth', columnWidths.table);

        console.log('Column state was invalid and has been reset to defaults');
      }
    }

    // Theme management
    function setTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem('theme', theme);

      // Update theme toggle icons
      if (theme === 'dark') {
        themeToggleDarkIcon.style.display = 'none';
        themeToggleLightIcon.style.display = 'block';
      } else {
        themeToggleDarkIcon.style.display = 'block';
        themeToggleLightIcon.style.display = 'none';
      }
    }

    // Check for saved theme preference or respect OS preference
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
      setTheme(savedTheme);
    } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      setTheme('dark');
    } else {
      setTheme('light');
    }

    // Cargar JSON guardado
    const savedJson = localStorage.getItem('jsonData');
    if (savedJson && savedJson.trim()) {
      jsonInput.value = savedJson;
      clearBtn.style.display = 'flex'; // Mostrar botón Clear si hay contenido
      try {
        parsedJson = JSON.parse(savedJson);
        copyBtn.style.display = 'flex'; // Mostrar el botón de copiar si hay JSON válido guardado
        updateViews();
      } catch (err) {
        // Ignorar si hay error en el JSON guardado
        copyBtn.style.display = 'none'; // Ocultar el botón si el JSON guardado no es válido
      }
    }

    // Update formatBtn text to show keyboard shortcut
    const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
    formatBtn.innerHTML = ` <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" fill="none" style="margin-right: 5px;"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg> 
            Format <span class="kbd-shortcut">${isMac ? '⌘' : 'Ctrl'}+Enter</span>`;

    // Event Listeners
    formatBtn.addEventListener('click', formatJson);
    clearBtn.addEventListener('click', clearAll);
    copyBtn.addEventListener('click', copyJson);
    toggleInputBtn.addEventListener('click', () => toggleColumn('input'));
    toggleTreeBtn.addEventListener('click', () => toggleColumn('tree'));
    toggleTableBtn.addEventListener('click', () => toggleColumn('table'));
    themeToggleBtn.addEventListener('click', () => {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      setTheme(currentTheme === 'light' ? 'dark' : 'light');
    });
    statsCloseBtn.addEventListener('click', () => {
      jsonStats.style.display = 'none';
    });

    // Add keyboard shortcut for formatting (Command+Enter or Control+Enter)
    jsonInput.addEventListener('keydown', (e) => {
      if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') {
        e.preventDefault();
        formatJson();
      }
    });

    // Save JSON data on change
    jsonInput.addEventListener('input', () => {
      const inputValue = jsonInput.value.trim();
      localStorage.setItem('jsonData', jsonInput.value);

      // Actualizar visibilidad del botón Clear
      clearBtn.style.display = inputValue ? 'flex' : 'none';
    });

    // Auto-format JSON when pasting
    jsonInput.addEventListener('paste', (e) => {
      setTimeout(() => {
        const pastedText = jsonInput.value.trim();
        if (pastedText) {
          try {
            JSON.parse(pastedText);
            formatJson();
          } catch (err) {
            showJsonError(`${err.message}`, pastedText);
          }
        }
      }, 0);
    });

    // Función auxiliar para verificar si un texto es JSON válido
    function isValidJSON(text) {
      try {
        JSON.parse(text);
        return true;
      } catch (e) {
        return false;
      }
    }

    // Expand/Collapse all tree nodes
    expandAllTreeBtn.addEventListener('click', () => {
      const toggleButtons = treeContainer.querySelectorAll('.tree-toggle');
      toggleButtons.forEach(btn => {
        const childrenContainer = btn.parentNode.nextElementSibling;
        if (childrenContainer && childrenContainer.style.display === 'none') {
          childrenContainer.style.display = 'block';
          btn.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="6 9 12 15 18 9"></polyline>
        </svg>
      `;
        }
      });
    });

    collapseAllTreeBtn.addEventListener('click', () => {
      const toggleButtons = treeContainer.querySelectorAll('.tree-toggle');
      toggleButtons.forEach(btn => {
        const childrenContainer = btn.parentNode.nextElementSibling;
        if (childrenContainer && childrenContainer.style.display !== 'none') {
          childrenContainer.style.display = 'none';
          btn.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      `;
        }
      });
    });

    // Expand/Collapse all table rows
    expandAllTableBtn.addEventListener('click', () => {
      const toggleButtons = tableContainer.querySelectorAll('.table-toggle');
      toggleButtons.forEach(btn => {
        const row = btn.closest('tr');
        const nextRow = row.nextElementSibling;
        if (nextRow && nextRow.style.display === 'none') {
          nextRow.style.display = 'table-row';
          btn.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="6 9 12 15 18 9"></polyline>
        </svg>
      `;
        }
      });
    });

    collapseAllTableBtn.addEventListener('click', () => {
      const toggleButtons = tableContainer.querySelectorAll('.table-toggle');
      toggleButtons.forEach(btn => {
        const row = btn.closest('tr');
        const nextRow = row.nextElementSibling;
        if (nextRow && nextRow.style.display !== 'none') {
          nextRow.style.display = 'none';
          btn.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      `;
        }
      });
    });

    // Search functionality
    searchBtn.addEventListener('click', performSearch);
    searchInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        performSearch();
      }
    });

    // Navigation between search results
    prevResultBtn.addEventListener('click', () => {
      if (currentResultIndex > 0) {
        currentResultIndex--;
        highlightResult(currentResultIndex);
      }
    });

    nextResultBtn.addEventListener('click', () => {
      if (currentResultIndex < searchResults.length - 1) {
        currentResultIndex++;
        highlightResult(currentResultIndex);
      }
    });

    function performSearch() {
      const searchTerm = searchInput.value.trim().toLowerCase();
      if (!searchTerm || !parsedJson) return;

      // Clear previous highlights
      clearSearchHighlights();

      // Find all matches in tree and table views
      searchResults = [];

      // Search in tree view
      findMatchesInTree(treeContainer, searchTerm);

      // Search in table view
      findMatchesInTable(tableContainer, searchTerm);

      // Update search stats
      searchCount.textContent = searchResults.length;
      searchStats.style.display = searchResults.length > 0 ? 'flex' : 'none';

      // Highlight first result if any found
      if (searchResults.length > 0) {
        currentResultIndex = 0;
        highlightResult(currentResultIndex);
      }
    }

    function findMatchesInTree(container, searchTerm) {
      const treeNodes = container.querySelectorAll('.tree-label');

      treeNodes.forEach(node => {
        const text = node.textContent.toLowerCase();

        if (text.includes(searchTerm)) {
          searchResults.push({
            element: node,
            type: 'tree'
          });

          // Highlight the matching text
          highlightTextInNode(node, searchTerm);

          // Expand all parent nodes to show the match
          expandParents(node);
        }
      });
    }

    function findMatchesInTable(container, searchTerm) {
      const tableCells = container.querySelectorAll('td');

      tableCells.forEach(cell => {
        const text = cell.textContent.toLowerCase();

        if (text.includes(searchTerm)) {
          searchResults.push({
            element: cell,
            type: 'table'
          });

          // Highlight the matching text
          highlightTextInNode(cell, searchTerm);

          // Expand parent row to show the match if it's in a nested table
          const row = cell.closest('tr');
          if (row.classList.contains('nested-row')) {
            row.style.display = 'table-row';
          }
        }
      });
    }

    function highlightTextInNode(node, searchTerm) {
      const text = node.textContent;
      const lowerText = text.toLowerCase();
      const searchTermLower = searchTerm.toLowerCase();

      let html = '';
      let lastIndex = 0;

      let index = lowerText.indexOf(searchTermLower);
      while (index !== -1) {
        // Add text before the match
        html += text.substring(lastIndex, index);

        // Add the highlighted match
        html += `<span class="search-highlight">${text.substring(index, index + searchTerm.length)}</span>`;

        lastIndex = index + searchTerm.length;
        index = lowerText.indexOf(searchTermLower, lastIndex);
      }

      // Add any remaining text
      html += text.substring(lastIndex);

      node.innerHTML = html;
    }

    function expandParents(node) {
      let current = node;

      // Navigate up to find tree-children containers and expand them
      while (current && current !== treeContainer) {
        if (current.classList.contains('tree-children') && current.style.display === 'none') {
          current.style.display = 'block';

          // Update the toggle button
          const parentContent = current.previousElementSibling;
          if (parentContent && parentContent.classList.contains('tree-content')) {
            const toggleBtn = parentContent.querySelector('.tree-toggle');
            if (toggleBtn) {
              toggleBtn.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        `;
            }
          }
        }

        current = current.parentNode;
      }
    }

    function clearSearchHighlights() {
      // Clear highlights in tree view
      const treeHighlights = treeContainer.querySelectorAll('.search-highlight');
      treeHighlights.forEach(highlight => {
        const parent = highlight.parentNode;
        parent.textContent = parent.textContent; // Simple way to remove all HTML and keep just text
      });

      // Clear highlights in table view
      const tableHighlights = tableContainer.querySelectorAll('.search-highlight');
      tableHighlights.forEach(highlight => {
        const parent = highlight.parentNode;
        parent.textContent = parent.textContent;
      });

      searchResults = [];
      currentResultIndex = -1;
    }

    function highlightResult(index) {
      if (index < 0 || index >= searchResults.length) return;

      const result = searchResults[index];
      result.element.scrollIntoView({ behavior: 'smooth', block: 'center' });

      // Make sure the view container is visible
      if (result.type === 'tree' && !showTree) {
        showTree = true;
        updateColumnVisibility();
      } else if (result.type === 'table' && !showTable) {
        showTable = true;
        updateColumnVisibility();
      }
    }

    // Functions
    function showError(message) {
      errorContainer.innerHTML = '';

      const errorDiv = document.createElement('div');
      errorDiv.className = 'error-message';

      // Añadir título del error
      const errorTitle = document.createElement('div');
      errorTitle.className = 'error-title';
      errorTitle.textContent = message;
      errorDiv.appendChild(errorTitle);

      // Añadir botón de cierre
      const closeBtn = document.createElement('button');
      closeBtn.className = 'error-close-btn';
      closeBtn.innerHTML = `
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="18" y1="6" x2="6" y2="18"></line>
      <line x1="6" y1="6" x2="18" y2="18"></line>
    </svg>
  `;
      closeBtn.addEventListener('click', () => {
        errorDiv.remove();
      });
      errorDiv.appendChild(closeBtn);

      errorContainer.appendChild(errorDiv);
    }

    // Función mejorada para mostrar errores JSON con posición
    function showJsonError(errorMessage, jsonText) {
      // Limpiar cualquier error anterior
      errorContainer.innerHTML = '';

      // Extraer la posición del error del mensaje (si existe)
      let errorPosition = -1;
      let errorLine = -1;
      let errorColumn = -1;

      // Primero intentamos encontrar la posición directa
      const positionMatch = errorMessage.match(/position (\d+)/i);
      if (positionMatch) {
        errorPosition = parseInt(positionMatch[1]);
      }
      // Si no hay posición, intentamos encontrar línea y columna
      else {
        const lineColMatch = errorMessage.match(/at line (\d+) column (\d+)/i);
        if (lineColMatch) {
          errorLine = parseInt(lineColMatch[1]);
          errorColumn = parseInt(lineColMatch[2]);

          // Convertir línea y columna a posición absoluta
          if (errorLine > 0 && errorColumn > 0) {
            let currentLine = 1;
            let currentCol = 1;

            for (let i = 0; i < jsonText.length; i++) {
              if (currentLine === errorLine && currentCol === errorColumn) {
                errorPosition = i;
                break;
              }

              if (jsonText[i] === '\n') {
                currentLine++;
                currentCol = 1;
              } else {
                currentCol++;
              }
            }
          }
        }
      }

      // Crear el contenedor principal del error
      const errorDiv = document.createElement('div');
      errorDiv.className = 'error-message';

      // Añadir título del error
      const errorTitle = document.createElement('div');
      errorTitle.className = 'error-title';
      errorTitle.textContent = `Error de JSON: ${errorMessage}`;
      errorDiv.appendChild(errorTitle);

      // Añadir botón de cierre
      const closeBtn = document.createElement('button');
      closeBtn.className = 'error-close-btn';
      closeBtn.innerHTML = `
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="18" y1="6" x2="6" y2="18"></line>
      <line x1="6" y1="6" x2="18" y2="18"></line>
    </svg>
  `;
      closeBtn.addEventListener('click', () => {
        errorDiv.remove();
      });
      errorDiv.appendChild(closeBtn);

      // Obtener ayuda descriptiva del error
      const helpMessage = getErrorHelp(errorMessage, jsonText, errorPosition);
      if (helpMessage && helpMessage.trim() !== '') {
        const helpElement = document.createElement('div');
        helpElement.className = 'error-help-message';
        helpElement.innerHTML = helpMessage;
        errorDiv.appendChild(helpElement);
      }

      // Si encontramos una posición válida
      if (errorPosition >= 0) {
        // Añadir información de posición con estilo clickeable
        const errorPos = document.createElement('div');
        errorPos.className = 'error-position';

        // Mostrar información de línea y columna si están disponibles
        if (errorLine > 0 && errorColumn > 0) {
          errorPos.innerHTML = `Error en línea ${errorLine}, columna ${errorColumn} <span class="click-hint">(haz clic para ir al punto exacto)</span>`;
        } else {
          errorPos.innerHTML = `Error en la posición ${errorPosition} <span class="click-hint">(haz clic para ir al punto exacto)</span>`;
        }

        errorPos.style.cursor = 'pointer';
        errorPos.title = 'Haz clic para posicionar el cursor en el error';

        // Al hacer clic, posicionar el cursor en el error
        errorPos.addEventListener('click', () => {
          jsonInput.focus();

          // Seleccionar un rango de caracteres alrededor del error para mayor visibilidad
          const selectionStart = Math.max(0, errorPosition - 1);
          const selectionEnd = Math.min(jsonText.length, errorPosition + 5);

          jsonInput.setSelectionRange(selectionStart, selectionEnd);

          // Hacer scroll para asegurar que el error es visible
          // Intentamos posicionar el error en el centro del textarea
          setTimeout(() => {
            // Calculamos aproximadamente la línea donde está el error
            let errorLine = 1;
            for (let i = 0; i < errorPosition; i++) {
              if (jsonText[i] === '\n') errorLine++;
            }

            // Calculamos la altura aproximada de la línea en el textarea
            const lineHeight = parseInt(window.getComputedStyle(jsonInput).lineHeight);

            // Posicionamos el scroll para mostrar el error centrado si es posible
            const scrollPosition = (errorLine * lineHeight) - (jsonInput.clientHeight / 2);
            jsonInput.scrollTop = Math.max(0, scrollPosition);
          }, 100);
        });

        errorDiv.appendChild(errorPos);

        // Calcular la línea y columna aproximada del error
        let line = 1;
        let column = 0;
        let isErrorHighlighted = false;

        // Formatear el JSON con numeración de líneas y resaltado de error
        const viewerDiv = document.createElement('div');
        viewerDiv.className = 'json-error-viewer';

        let formattedHtml = '';

        for (let i = 0; i < jsonText.length; i++) {
          // Nueva línea
          if (jsonText[i] === '\n' || i === 0) {
            if (i !== 0) {
              formattedHtml += '</span>\n';
              line++;
              column = 0;
            }

            // Añadir número de línea
            formattedHtml += `<span class="line-number">${line}</span><span class="json-line">`;
          }

          // Resaltar posición del error
          if (i === errorPosition) {
            formattedHtml += '<span class="json-error-highlight" title="Haz clic para posicionar el cursor en el error" style="cursor:pointer;" data-error-position="' + errorPosition + '">';
            isErrorHighlighted = true;
          }

          // Escapar caracteres HTML
          let char = jsonText[i];
          if (char === '<') char = '&lt;';
          else if (char === '>') char = '&gt;';
          else if (char === '&') char = '&amp;';

          // Añadir carácter
          if (char !== '\n' || i === 0) {
            formattedHtml += char;
            column++;
          }

          // Cerrar span de error después de algunos caracteres
          if (isErrorHighlighted && (i >= errorPosition + 5 || i === jsonText.length - 1)) {
            formattedHtml += '</span>';
            isErrorHighlighted = false;
          }
        }

        // Cerrar el último span de línea
        formattedHtml += '</span>';

        viewerDiv.innerHTML = formattedHtml;
        errorDiv.appendChild(viewerDiv);
      }

      // Añadir al contenedor
      errorContainer.appendChild(errorDiv);

      // Añadir event listener a los elementos resaltados
      const highlightElements = errorDiv.querySelectorAll('.json-error-highlight');
      highlightElements.forEach(el => {
        el.addEventListener('click', () => {
          jsonInput.focus();

          // Seleccionar un rango de caracteres alrededor del error para mayor visibilidad
          const selectionStart = Math.max(0, errorPosition - 1);
          const selectionEnd = Math.min(jsonText.length, errorPosition + 5);

          jsonInput.setSelectionRange(selectionStart, selectionEnd);

          // Hacer scroll para asegurar que el error es visible
          // Intentamos posicionar el error en el centro del textarea
          setTimeout(() => {
            // Calculamos aproximadamente la línea donde está el error
            let errorLine = 1;
            for (let i = 0; i < errorPosition; i++) {
              if (jsonText[i] === '\n') errorLine++;
            }

            // Calculamos la altura aproximada de la línea en el textarea
            const lineHeight = parseInt(window.getComputedStyle(jsonInput).lineHeight);

            // Posicionamos el scroll para mostrar el error centrado si es posible
            const scrollPosition = (errorLine * lineHeight) - (jsonInput.clientHeight / 2);
            jsonInput.scrollTop = Math.max(0, scrollPosition);
          }, 100);
        });
      });
    }

    // Función auxiliar para proporcionar mensajes de ayuda basados en el tipo de error
    function getErrorHelp(errorMessage, jsonText, errorPosition) {
      // Mensajes de error comunes con sus sugerencias
      if (/expected double-quoted property name/.test(errorMessage)) {
        // Error específico para propiedades que no están entre comillas
        return `<strong>Error:</strong> Falta comillas dobles en el nombre de propiedad.<br>
           <strong>Posible solución:</strong> En JSON, todas las claves de objetos deben estar entre comillas dobles. Revisa que no hayas dejado una coma extra o que no hayas cerrado el objeto o array con el carácter equivocado.<br>
           <strong>Ejemplo correcto:</strong> <code>{"propiedad": valor}</code><br>
           <strong>Ejemplo incorrecto:</strong> <code>{propiedad: valor}</code>`;
      } else if (/Unexpected token (.)/.test(errorMessage)) {
        const token = errorMessage.match(/Unexpected token (.)/)[1];
        let context = '';

        if (errorPosition >= 0 && errorPosition < jsonText.length) {
          // Extraer un fragmento del contexto alrededor del error
          const start = Math.max(0, errorPosition - 10);
          const end = Math.min(jsonText.length, errorPosition + 10);
          context = jsonText.substring(start, errorPosition) + '<span class="error-context-highlight">' +
            jsonText.charAt(errorPosition) + '</span>' +
            jsonText.substring(errorPosition + 1, end);
          context = context.replace(/\n/g, ' ');
        }

        if (token === '{' || token === '[') {
          return `<strong>Error:</strong> Se encontró un carácter de apertura ${token} inesperado.<br>
             <strong>Posible solución:</strong> Verifica que no tengas caracteres de apertura duplicados o que no estés cerrando un objeto o array con el carácter equivocado.`;
        } else if (token === '}' || token === ']') {
          return `<strong>Error:</strong> Se encontró un carácter de cierre ${token} inesperado.<br>
             <strong>Posible solución:</strong> Verifica que no tengas llave o corchete de cierre sin su correspondiente apertura. También comprueba que no hayas olvidado una coma entre elementos o que no tengas una coma extra después del último elemento.`;
        } else if (token === ',') {
          return `<strong>Error:</strong> Se encontró una coma inesperada.<br>
             <strong>Posible solución:</strong> Asegúrate de no tener comas extra después del último elemento en un objeto o array, o comas consecutivas. Ejemplo incorrecto: <code>{"a": 1, "b": 2,}</code> o <code>{"a": 1,, "b": 2}</code>`;
        } else if (token === ':') {
          return `<strong>Error:</strong> Se encontró dos puntos inesperados.<br>
             <strong>Posible solución:</strong> Los dos puntos en JSON solo deben aparecer después de una clave de propiedad. Verifica que la clave sea una cadena válida entre comillas dobles. Ejemplo correcto: <code>"clave": valor</code>`;
        } else {
          return `<strong>Error:</strong> Se encontró un carácter inesperado "${token}".<br>
             <strong>Contexto:</strong> <code>...${context}...</code><br>
             <strong>Posible solución:</strong> Revisa la sintaxis JSON en esta posición.`;
        }
      } else if (/unterminated string/.test(errorMessage)) {
        // Caso específico para cadenas sin terminar
        let context = '';
        if (errorPosition >= 0 && errorPosition < jsonText.length) {
          const start = Math.max(0, errorPosition - 15);
          const end = Math.min(jsonText.length, errorPosition + 15);
          context = jsonText.substring(start, end);
          context = context.replace(/\n/g, ' ');
        }

        return `<strong>Error:</strong> Cadena sin terminar - falta una comilla de cierre.<br>
           <strong>Contexto:</strong> <code>...${context}...</code><br>
           <strong>Posible solución:</strong> Añade una comilla doble (") al final de la cadena o verifica que no haya caracteres de comilla sin escapar dentro de la cadena.`;
      } else if (/Unexpected end of (JSON input|input)/.test(errorMessage)) {
        return `<strong>Error:</strong> El JSON está incompleto.<br>
           <strong>Posible solución:</strong> Verifica que todas las llaves {}, corchetes [] y comillas " estén correctamente balanceados y cerrados.`;
      } else if (/Unexpected number/.test(errorMessage)) {
        return `<strong>Error:</strong> Número en formato incorrecto.<br>
           <strong>Posible solución:</strong> Verifica que los números no tengan formatos inválidos como ceros iniciales (excepto para decimales), signos + explícitos, o que no estén usando notación científica incorrectamente.`;
      } else if (/Expected property name/.test(errorMessage)) {
        return `<strong>Error:</strong> Se esperaba un nombre de propiedad.<br>
           <strong>Posible solución:</strong> En JSON, las claves de los objetos deben ser cadenas entre comillas dobles. Ejemplo correcto: <code>{"propiedad": valor}</code>`;
      } else if (/Expected ':' after property name/.test(errorMessage)) {
        return `<strong>Error:</strong> Falta el carácter ':' después del nombre de la propiedad.<br>
           <strong>Posible solución:</strong> En JSON, después de cada nombre de propiedad debe ir el carácter ':'. Ejemplo correcto: <code>{"propiedad": valor}</code>`;
      } else if (/Expected ',' or '}'/.test(errorMessage)) {
        return `<strong>Error:</strong> Se esperaba una coma o llave de cierre.<br>
           <strong>Posible solución:</strong> Los pares clave-valor en los objetos deben estar separados por comas. Verifica que no falte una coma entre elementos o que el formato sea correcto.`;
      } else if (/Expected ',' or ']'/.test(errorMessage)) {
        return `<strong>Error:</strong> Se esperaba una coma o corchete de cierre.<br>
           <strong>Posible solución:</strong> Los elementos en un array deben estar separados por comas. Verifica que no falte una coma entre elementos o que el formato sea correcto.`;
      } else if (/Invalid or unexpected token/.test(errorMessage)) {
        return `<strong>Error:</strong> Token inválido o inesperado.<br>
           <strong>Posible solución:</strong> Esto suele ocurrir cuando las cadenas no están correctamente delimitadas con comillas dobles o cuando hay caracteres de control sin escapar dentro de una cadena.`;
      } else if (/expected property name or '}'/i.test(errorMessage)) {
        return `<strong>Error:</strong> Se esperaba un nombre de propiedad o llave de cierre.<br>
          <strong>Posible solución:</strong> Verifica que no existan comas adicionales al final del objeto o que no falte un nombre de propiedad después de una coma.`;
      } else if (/expected ':' after property name/i.test(errorMessage)) {
        return `<strong>Error:</strong> Falta el carácter ':' después del nombre de la propiedad.<br>
          <strong>Posible solución:</strong> En JSON, después de cada nombre de propiedad debe ir el carácter ':'. Ejemplo correcto: <code>{"propiedad": valor}</code>`;
      } else if (/unexpected non-whitespace character after JSON/i.test(errorMessage)) {
        return `<strong>Error:</strong> Caracteres adicionales después del JSON.<br>
          <strong>Posible solución:</strong> Un documento JSON válido debe contener un único objeto o array en la raíz. Elimina cualquier texto adicional después del objeto/array principal.`;
      }

      // Si no hay un mensaje específico, no devolvemos nada (eliminamos el mensaje genérico)
      return '';
    }

    function formatJson() {
      const input = jsonInput.value.trim();
      errorContainer.innerHTML = '';
      jsonStats.style.display = 'none';

      if (!input) {
        showError('Please enter JSON data');
        parsedJson = null;
        updateViews();
        return;
      }

      try {
        parsedJson = JSON.parse(input);
        jsonInput.value = JSON.stringify(parsedJson, null, 2);
        localStorage.setItem('jsonData', jsonInput.value);
        showTree = true;
        showTable = true;
        clearBtn.style.display = 'flex'; // Mostrar el botón Clear cuando hay JSON válido
        updateColumnVisibility();
        updateViews();
        calculateJsonStats(parsedJson);
      } catch (err) {
        showJsonError(`${err.message}`, input);
        parsedJson = null;
        updateViews();
      }
    }

    function clearAll() {
      jsonInput.value = '';
      errorContainer.innerHTML = '';
      parsedJson = null;
      localStorage.removeItem('jsonData');
      jsonStats.style.display = 'none';
      searchStats.style.display = 'none';
      copyBtn.style.display = 'none'; // Ocultar el botón de copiar al limpiar
      clearBtn.style.display = 'none'; // Ocultar el botón de limpiar
      updateViews();
    }

    function copyJson() {
      const input = jsonInput.value.trim();
      if (!input) {
        showError('There is no content to copy');
        return;
      }

      // Copiar al portapapeles
      navigator.clipboard.writeText(input)
        .then(() => {
          // Guardar el contenido original del botón
          const originalContent = copyBtn.innerHTML;
          // Extraer el SVG
          const svgContent = copyBtn.querySelector('svg').outerHTML;

          // Actualizar con el mensaje de éxito manteniendo el icono
          copyBtn.innerHTML = `${svgContent} Copied!`;

          // Restaurar después de 2 segundos
          setTimeout(() => {
            copyBtn.innerHTML = originalContent;
          }, 2000);
        })
        .catch(err => {
          showError('Error copying: ' + err.message);
        });
    }

    function toggleColumn(column) {
      if (column === 'input') {
        showInput = !showInput;
      } else if (column === 'tree') {
        showTree = !showTree;
      } else if (column === 'table') {
        showTable = !showTable;
      }

      updateColumnVisibility();
    }

    // Actualizar la función updateColumnVisibility para usar los anchos guardados
    function updateColumnVisibility() {
      // Make sure at least one column is visible
      if (!showInput && !showTree && !showTable) {
        showInput = true;
      }

      // Update column display
      inputColumn.style.display = showInput ? 'flex' : 'none';
      treeColumn.style.display = showTree && parsedJson ? 'flex' : 'none';
      tableColumn.style.display = showTable && parsedJson ? 'flex' : 'none';

      // Update resizer visibility
      const resizerInputTree = document.getElementById('resizer-input-tree');
      const resizerTreeTable = document.getElementById('resizer-tree-table');

      resizerInputTree.style.display = (showInput && (showTree && parsedJson)) ? 'block' : 'none';
      resizerTreeTable.style.display = ((showTree && parsedJson) && (showTable && parsedJson)) ? 'block' : 'none';

      // Calculate column widths based on visible columns
      const visibleCount = [showInput, showTree && parsedJson, showTable && parsedJson].filter(Boolean).length;

      // Resetear los anchos para evitar problemas
      document.querySelectorAll('.column').forEach(col => {
        col.style.flex = '0 0 auto';
      });

      if (visibleCount === 1) {
        // If only one column is visible, it takes full width
        if (showInput) inputColumn.style.width = '100%';
        if (showTree && parsedJson) treeColumn.style.width = '100%';
        if (showTable && parsedJson) tableColumn.style.width = '100%';
      } else if (visibleCount === 2) {
        // If two columns are visible, use stored widths or split evenly
        if (showInput && showTree && parsedJson) {
          const inputWidth = localStorage.getItem('inputColumnWidth') || '50%';
          const treeWidth = localStorage.getItem('treeColumnWidth') || '50%';
          inputColumn.style.width = inputWidth;
          treeColumn.style.width = treeWidth;
        } else if (showInput && showTable && parsedJson) {
          const inputWidth = localStorage.getItem('inputColumnWidth') || '50%';
          const tableWidth = localStorage.getItem('tableColumnWidth') || '50%';
          inputColumn.style.width = inputWidth;
          tableColumn.style.width = tableWidth;
        } else if (showTree && parsedJson && showTable && parsedJson) {
          const treeWidth = localStorage.getItem('treeColumnWidth') || '50%';
          const tableWidth = localStorage.getItem('tableColumnWidth') || '50%';
          treeColumn.style.width = treeWidth;
          tableColumn.style.width = tableWidth;
        }
      } else if (visibleCount === 3) {
        // If all three columns are visible, use stored widths or default to equal distribution
        const storedInputWidth = localStorage.getItem('inputColumnWidth');
        const storedTreeWidth = localStorage.getItem('treeColumnWidth');
        const storedTableWidth = localStorage.getItem('tableColumnWidth');

        // Si hay valores almacenados, usarlos; de lo contrario, distribución igual
        inputColumn.style.width = storedInputWidth || '33.33%';
        treeColumn.style.width = storedTreeWidth || '33.33%';
        tableColumn.style.width = storedTableWidth || '33.33%';

        // Actualizar variables de estado
        columnWidths.input = inputColumn.style.width;
        columnWidths.tree = treeColumn.style.width;
        columnWidths.table = tableColumn.style.width;
      }

      // Forzar un reflow para actualizar los anchos
      void mainContent.offsetWidth;

      // Add empty state if needed
      if (mainContent.children.length === 0) {
        const emptyState = document.createElement('div');
        emptyState.className = 'empty-state';
        emptyState.textContent = 'All panels are hidden. Click the toggle buttons to show content.';
        mainContent.appendChild(emptyState);
      } else {
        const emptyState = mainContent.querySelector('.empty-state');
        if (emptyState) emptyState.remove();
      }
    }

    function updateViews() {
      if (parsedJson) {
        renderTreeView(parsedJson);
        renderTableView(parsedJson);
        copyBtn.style.display = 'flex'; // Mostrar el botón de copiar cuando hay JSON válido
      } else {
        treeContainer.innerHTML = '';
        tableContainer.innerHTML = '';
        copyBtn.style.display = 'none'; // Ocultar el botón de copiar cuando no hay JSON válido
      }
      updateColumnVisibility();
    }

    // Tree View Rendering
    function renderTreeView(data) {
      treeContainer.innerHTML = '';
      const treeRoot = createTreeNode(data);
      treeContainer.appendChild(treeRoot);
    }

    function createTreeNode(data, key, level = 0) {
      const nodeContainer = document.createElement('div');
      nodeContainer.className = 'tree-node';

      const nodeContent = document.createElement('div');
      nodeContent.className = 'tree-content';

      const isObject = data !== null && typeof data === 'object';
      const isArray = Array.isArray(data);

      // Create toggle button for objects and arrays
      const toggleBtn = document.createElement('div');
      toggleBtn.className = 'tree-toggle';

      if (isObject) {
        toggleBtn.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="6 9 12 15 18 9"></polyline>
      </svg>
    `;
      } else {
        toggleBtn.style.visibility = 'hidden';
      }

      nodeContent.appendChild(toggleBtn);

      // Create label
      const label = document.createElement('span');
      label.className = 'tree-label';

      if (key !== undefined) {
        if (isObject) {
          const count = isArray ? data.length : Object.keys(data).length;
          label.textContent = `${key}: ${isArray ? '[' : '{'} ${count} ${count === 1 ? 'item' : 'items'} ${isArray ? ']' : '}'}`;
        } else {
          label.textContent = `${key}: `;

          // Add value with appropriate styling
          const value = document.createElement('span');
          if (data === null) {
            value.className = 'null-value';
            value.textContent = 'null';
          } else if (typeof data === 'string') {
            value.className = 'string-value';
            value.textContent = `"${data}"`;
          } else if (typeof data === 'number') {
            value.className = 'number-value';
            value.textContent = data;
          } else if (typeof data === 'boolean') {
            value.className = 'boolean-value';
            value.textContent = data;
          } else {
            value.textContent = data;
          }
          label.appendChild(value);
        }
      } else {
        if (isArray) {
          label.textContent = `Array [${data.length}]`;
        } else if (isObject) {
          label.textContent = `Object {${Object.keys(data).length}}`;
        } else {
          label.textContent = String(data);
        }
      }

      nodeContent.appendChild(label);
      nodeContainer.appendChild(nodeContent);

      // Create children container for objects and arrays
      if (isObject) {
        const childrenContainer = document.createElement('div');
        childrenContainer.className = 'tree-children';

        if (isArray) {
          data.forEach((item, index) => {
            const childNode = createTreeNode(item, String(index), level + 1);
            childrenContainer.appendChild(childNode);
          });
        } else {
          Object.entries(data).forEach(([childKey, value]) => {
            const childNode = createTreeNode(value, childKey, level + 1);
            childrenContainer.appendChild(childNode);
          });
        }

        nodeContainer.appendChild(childrenContainer);

        // Toggle functionality
        toggleBtn.addEventListener('click', () => {
          const isExpanded = childrenContainer.style.display !== 'none';
          childrenContainer.style.display = isExpanded ? 'none' : 'block';
          toggleBtn.innerHTML = isExpanded
            ? `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>`
            : `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>`;
        });

        // Auto-collapse deeper levels
        if (level >= 2) {
          childrenContainer.style.display = 'none';
          toggleBtn.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      `;
        }
      }

      return nodeContainer;
    }

    // Table View Rendering
    function renderTableView(data) {
      tableContainer.innerHTML = '';

      if (Array.isArray(data)) {
        tableContainer.appendChild(createArrayTable(data));
      } else if (typeof data === 'object' && data !== null) {
        tableContainer.appendChild(createObjectTable(data));
      } else {
        tableContainer.textContent = String(data);
      }
    }

    function createObjectTable(data, level = 0) {
      const table = document.createElement('table');

      // Create header
      const thead = document.createElement('thead');
      const headerRow = document.createElement('tr');
      const keyHeader = document.createElement('th');
      keyHeader.textContent = 'Key';
      keyHeader.style.width = '30%';
      const valueHeader = document.createElement('th');
      valueHeader.textContent = 'Value';

      headerRow.appendChild(keyHeader);
      headerRow.appendChild(valueHeader);
      thead.appendChild(headerRow);
      table.appendChild(thead);

      // Create body
      const tbody = document.createElement('tbody');

      Object.entries(data).forEach(([key, value]) => {
        const isComplex = value !== null && typeof value === 'object';

        // Create main row
        const row = document.createElement('tr');
        const keyCell = document.createElement('td');
        const valueCell = document.createElement('td');

        // Key cell with toggle for complex values
        if (isComplex) {
          const toggleBtn = document.createElement('span');
          toggleBtn.className = 'table-toggle';
          toggleBtn.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="6 9 12 15 18 9"></polyline>
        </svg>
      `;
          keyCell.appendChild(toggleBtn);
        }

        const keyText = document.createTextNode(key);
        keyCell.appendChild(keyText);
        row.appendChild(keyCell);

        // Value cell
        if (!isComplex) {
          if (value === null) {
            valueCell.innerHTML = '<span class="null-value">null</span>';
          } else if (typeof value === 'string') {
            valueCell.innerHTML = `<span class="string-value">"${value}"</span>`;
          } else if (typeof value === 'number') {
            valueCell.innerHTML = `<span class="number-value">${value}</span>`;
          } else if (typeof value === 'boolean') {
            valueCell.innerHTML = `<span class="boolean-value">${value}</span>`;
          } else {
            valueCell.textContent = String(value);
          }
        } else {
          const count = Array.isArray(value) ? value.length : Object.keys(value).length;
          valueCell.innerHTML = `<span class="muted">${Array.isArray(value) ? 'Array' : 'Object'} (${count} ${count === 1 ? 'item' : 'items'})</span>`;
        }

        row.appendChild(valueCell);
        tbody.appendChild(row);

        // Create nested table row for complex values
        if (isComplex) {
          const nestedRow = document.createElement('tr');
          nestedRow.style.display = 'none';

          const nestedCell = document.createElement('td');
          nestedCell.colSpan = 2;
          nestedCell.className = 'nested-table';

          const nestedTable = Array.isArray(value)
            ? createArrayTable(value, level + 1)
            : createObjectTable(value, level + 1);

          nestedCell.appendChild(nestedTable);
          nestedRow.appendChild(nestedCell);
          tbody.appendChild(nestedRow);

          // Toggle functionality
          const toggleBtn = keyCell.querySelector('.table-toggle');
          toggleBtn.addEventListener('click', () => {
            const isExpanded = nestedRow.style.display !== 'none';
            nestedRow.style.display = isExpanded ? 'none' : 'table-row';
            toggleBtn.innerHTML = isExpanded
              ? `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>`
              : `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>`;
          });
        }
      });

      table.appendChild(tbody);
      return table;
    }

    function createArrayTable(data, level = 0) {
      const table = document.createElement('table');

      // Create header
      const thead = document.createElement('thead');
      const headerRow = document.createElement('tr');
      const indexHeader = document.createElement('th');
      indexHeader.textContent = 'Index';
      indexHeader.style.width = '30%';
      const valueHeader = document.createElement('th');
      valueHeader.textContent = 'Value';

      headerRow.appendChild(indexHeader);
      headerRow.appendChild(valueHeader);
      thead.appendChild(headerRow);
      table.appendChild(thead);

      // Create body
      const tbody = document.createElement('tbody');

      data.forEach((value, index) => {
        const isComplex = value !== null && typeof value === 'object';

        // Create main row
        const row = document.createElement('tr');
        const indexCell = document.createElement('td');
        const valueCell = document.createElement('td');

        // Index cell with toggle for complex values
        if (isComplex) {
          const toggleBtn = document.createElement('span');
          toggleBtn.className = 'table-toggle';
          toggleBtn.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="6 9 12 15 18 9"></polyline>
        </svg>
      `;
          indexCell.appendChild(toggleBtn);
        }

        const indexText = document.createTextNode(index);
        indexCell.appendChild(indexText);
        row.appendChild(indexCell);

        // Value cell
        if (!isComplex) {
          if (value === null) {
            valueCell.innerHTML = '<span class="null-value">null</span>';
          } else if (typeof value === 'string') {
            valueCell.innerHTML = `<span class="string-value">"${value}"</span>`;
          } else if (typeof value === 'number') {
            valueCell.innerHTML = `<span class="number-value">${value}</span>`;
          } else if (typeof value === 'boolean') {
            valueCell.innerHTML = `<span class="boolean-value">${value}</span>`;
          } else {
            valueCell.textContent = String(value);
          }
        } else {
          const count = Array.isArray(value) ? value.length : Object.keys(value).length;
          valueCell.innerHTML = `<span class="muted">${Array.isArray(value) ? 'Array' : 'Object'} (${count} ${count === 1 ? 'item' : 'items'})</span>`;
        }

        row.appendChild(valueCell);
        tbody.appendChild(row);

        // Create nested table row for complex values
        if (isComplex) {
          const nestedRow = document.createElement('tr');
          nestedRow.style.display = 'none';

          const nestedCell = document.createElement('td');
          nestedCell.colSpan = 2;
          nestedCell.className = 'nested-table';

          const nestedTable = Array.isArray(value)
            ? createArrayTable(value, level + 1)
            : createObjectTable(value, level + 1);

          nestedCell.appendChild(nestedTable);
          nestedRow.appendChild(nestedCell);
          tbody.appendChild(nestedRow);

          // Toggle functionality
          const toggleBtn = indexCell.querySelector('.table-toggle');
          toggleBtn.addEventListener('click', () => {
            const isExpanded = nestedRow.style.display !== 'none';
            nestedRow.style.display = isExpanded ? 'none' : 'table-row';
            toggleBtn.innerHTML = isExpanded
              ? `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>`
              : `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>`;
          });
        }
      });

      table.appendChild(tbody);
      return table;
    }

    // Calculate JSON statistics
    function calculateJsonStats(data) {
      // Reset counters
      let counts = {
        object: 0,
        array: 0,
        string: 0,
        number: 0,
        boolean: 0,
        null: 0
      };

      // Count recursively
      countTypes(data, counts);

      // Update DOM
      objectCount.textContent = counts.object;
      arrayCount.textContent = counts.array;
      stringCount.textContent = counts.string;
      numberCount.textContent = counts.number;
      booleanCount.textContent = counts.boolean;
      nullCount.textContent = counts.null;

      // Show stats
      jsonStats.style.display = 'grid';
    }

    function countTypes(data, counts) {
      if (data === null) {
        counts.null++;
      }
      else if (Array.isArray(data)) {
        counts.array++;
        data.forEach(item => countTypes(item, counts));
      }
      else if (typeof data === 'object') {
        counts.object++;
        Object.values(data).forEach(value => countTypes(value, counts));
      }
      else if (typeof data === 'string') {
        counts.string++;
      }
      else if (typeof data === 'number') {
        counts.number++;
      }
      else if (typeof data === 'boolean') {
        counts.boolean++;
      }
    }

    // Initialize
    updateColumnVisibility();
    validateColumnState(); // Validar estado de columnas al inicio
    loadResizePreference(); // Cargar preferencia de modo resize
    setupResizers();

    // Add resizer functionality
    function setupResizers() {
      const resizerInputTree = document.getElementById('resizer-input-tree');
      const resizerTreeTable = document.getElementById('resizer-tree-table');

      function attachResizeHandler(resizer, leftCol, rightCol, leftKey, rightKey) {
        if (!resizer) return;

        // Función que se ejecuta cuando se presiona el ratón sobre el divisor
        function onMouseDown(e) {
          e.preventDefault();

          // Solo continuar si ambas columnas son visibles
          if (leftCol.style.display === 'none' || rightCol.style.display === 'none') {
            return;
          }

          // Marcar el divisor como activo visualmente
          resizer.classList.add('active');
          document.body.classList.add('resizing');

          // Guardar posición inicial y dimensiones exactas para cálculos precisos
          const startX = e.clientX;
          const mainContentRect = mainContent.getBoundingClientRect();
          const leftRect = leftCol.getBoundingClientRect();
          const rightRect = rightCol.getBoundingClientRect();
          const totalWidth = mainContentRect.width;

          // Añadir un indicador visual durante el arrastre
          resizer.style.transition = 'none';
          resizer.style.backgroundColor = 'var(--color-resizer-hover)';

          // Crear un overlay invisible para capturar eventos de ratón
          const overlay = document.createElement('div');
          overlay.style.position = 'fixed';
          overlay.style.top = '0';
          overlay.style.left = '0';
          overlay.style.right = '0';
          overlay.style.bottom = '0';
          overlay.style.zIndex = '9999';
          overlay.style.cursor = 'col-resize';
          document.body.appendChild(overlay);

          // Función que se ejecuta cuando se mueve el ratón
          function onMouseMove(e) {
            // Solicitar el próximo frame para la animación
            requestAnimationFrame(() => {
              // Calcular desplazamiento exacto
              const deltaX = e.clientX - startX;

              // Calcular nuevos anchos respetando restricciones
              let newLeftWidth = Math.max(100, leftRect.width + deltaX);
              let newRightWidth = Math.max(100, rightRect.width - deltaX);

              // Asegurar que no excedan el ancho total
              const totalNewWidth = newLeftWidth + newRightWidth;
              if (totalNewWidth > totalWidth) {
                const ratio = totalWidth / totalNewWidth;
                newLeftWidth *= ratio;
                newRightWidth *= ratio;
              }

              // Calcular porcentajes precisos
              const leftPercent = (newLeftWidth / totalWidth * 100).toFixed(2) + '%';
              const rightPercent = (newRightWidth / totalWidth * 100).toFixed(2) + '%';

              // Aplicar nuevos anchos directamente al estilo
              leftCol.style.width = leftPercent;
              rightCol.style.width = rightPercent;

              // Guardar en localStorage para persistencia
              localStorage.setItem(`${leftKey}ColumnWidth`, leftPercent);
              localStorage.setItem(`${rightKey}ColumnWidth`, rightPercent);
              columnWidths[leftKey] = leftPercent;
              columnWidths[rightKey] = rightPercent;
            });
          }

          // Función que se ejecuta cuando se suelta el ratón
          function onMouseUp() {
            // Limpiar clases y eventos
            resizer.classList.remove('active');
            document.body.classList.remove('resizing');
            document.body.removeChild(overlay);

            // Restaurar estilos de transición
            resizer.style.transition = '';

            // Eliminar listeners para evitar memory leaks
            document.removeEventListener('mousemove', onMouseMove);
            document.removeEventListener('mouseup', onMouseUp);
          }

          // Agregar listeners temporales para el arrastre
          document.addEventListener('mousemove', onMouseMove);
          document.addEventListener('mouseup', onMouseUp);
        }

        // Elimina cualquier listener existente y agrega uno nuevo
        resizer.removeEventListener('mousedown', onMouseDown);
        resizer.addEventListener('mousedown', onMouseDown);
      }

      // Configurar los dos divisores
      attachResizeHandler(resizerInputTree, inputColumn, treeColumn, 'input', 'tree');
      attachResizeHandler(resizerTreeTable, treeColumn, tableColumn, 'tree', 'table');
    }
  </script>
</body>

</html>
